import Foundation

// Clase base: Persona
class Persona {
    var nombre: String
    var lugar: Lugar
    var maestro: Maestro?
    
    init(nombre: String, lugar: Lugar) {
        self.nombre = nombre
        self.lugar = lugar
    }
    
    func descripcion() {
        print("\n--- InformaciÃ³n del personaje ---")
        print("Nombre: \(nombre)")
        print("Lugar de nacimiento: \(lugar.nombre)")
        
        if let maestro = maestro {
            print("Es maestr@: \(maestro.tipo)")
            
            if maestro.subElementos.isEmpty {
                print("No domina sub-elementos especiales.")
            } else {
                print("Sub-elementos: \(maestro.subElementos.joined(separator: ", "))")
            }
        } else {
            print("No es maestro de ningÃºn elemento.")
        }
    }
}

// Clase Lugar
class Lugar {
    var nombre: String
    
    init(nombre: String) {
        self.nombre = nombre
    }
    
    // Lista centralizada de lugares posibles
    static let todos = [
        "Ba Sing Se", "Omashu", "Tribu Agua del Norte", "Tribu Agua del Sur", "Tribu Agua del Pantano",
        "Templos Aire del Norte", "Templos Aire del Sur", "Templos Aire del Este", "Templos Aire del Oeste",
        "NaciÃ³n del Fuego"
    ]
    
    // Devuelve un lugar aleatorio
    static func lugarAleatorio() -> Lugar {
        let nombre = todos.randomElement() ?? "Lugar desconocido"
        return Lugar(nombre: nombre)
    }
    
    // Determina el elemento principal segÃºn el lugar
    func elementoPrincipal() -> String {
        switch nombre {
        case "Ba Sing Se", "Omashu":
            return "Tierra"
        case "Tribu Agua del Norte", "Tribu Agua del Sur", "Tribu Agua del Pantano":
            return "Agua"
        case "Templos Aire del Norte", "Templos Aire del Sur", "Templos Aire del Este", "Templos Aire del Oeste":
            return "Aire"
        case "NaciÃ³n del Fuego":
            return "Fuego"
        default:
            return "Desconocido"
        }
    }
}

// Clase Maestro
class Maestro {
    var tipo: String
    var subElementos: [String]
    
    init(tipo: String, subElementos: [String]) {
        self.tipo = tipo
        self.subElementos = subElementos
    }
    
    static func maestroAleatorio(lugar: Lugar) -> Maestro {
        let esAvatar = Int.random(in: 1...100) <= 5 // 5% de probabilidad de ser Avatar
        let tipo: String
        
        if esAvatar {
            tipo = "Avatar"
        } else {
            tipo = lugar.elementoPrincipal() // Ahora concuerda con el lugar
        }
        
        let subElementos = SubElemento.subElementosPorTipo(tipo: tipo)
        return Maestro(tipo: tipo, subElementos: subElementos)
    }
}


class SubElemento {
    private static func elegirSubelementos(_ opciones: [String]) -> [String] {
        // Siempre devuelve al menos 1 sub-elemento, hasta todos
        return opciones.shuffled().prefix(Int.random(in: 1...opciones.count)).map { $0 }
    }
    
    static func subElementosPorTipo(tipo: String) -> [String] {
        switch tipo {
        case "Agua":
            return elegirSubelementos(["CuraciÃ³n", "Sangre control", "Hielo"])
        case "Tierra":
            return elegirSubelementos(["Metal control", "Lava control", "Arena control"])
        case "Fuego":
            return elegirSubelementos(["Rayo control", "CombustiÃ³n control"])
        case "Aire":
            return elegirSubelementos(["ProyecciÃ³n espiritual", "Vuelo"])
        case "Avatar":
            return ["MAESTRO DE TODOS LOS ELEMENTOS"]
        default:
            return []
        }
    }
}

class GeneradorAvatar {
    static func generar(nombre: String) -> Persona {
        let lugar = Lugar.lugarAleatorio()
        let persona = Persona(nombre: nombre, lugar: lugar)
        persona.maestro = Maestro.maestroAleatorio(lugar: lugar) // <-- aquÃ­ se pasa el lugar
        return persona
    }
}

// ----------- MAIN -----------

print("Bienvenido al generador del mundo Avatar ðŸª¨ ðŸ”¥ ðŸ’§ ðŸŒªï¸")
print("Introduce el nombre de tu personaje:")

if let nombre = readLine(), !nombre.isEmpty {
    let personaje = GeneradorAvatar.generar(nombre: nombre)
    personaje.descripcion()
} else {
    print("No introdujiste un nombre vÃ¡lido. Intenta de nuevo.")
}
